# Устранение неполадок

## Проблема: Тестовые сообщения не отправляются

### Симптомы:
- При нажатии кнопки "Тестовый пост" отображается сообщение "Тестовый пост успешно отправлен..."
- Однако тестовое сообщение не появляется ни в одной из социальных сетей

### Возможные причины и решения:

#### 1. Проблема с зашифрованными токенами

**Причина:** Токены аккаунтов были зашифрованы с помощью другого ключа шифрования, который больше не используется.

**Решение:**
1. Убедитесь, что в файле `.env` установлена постоянная переменная `ENCRYPTION_KEY`:
   ```bash
   ENCRYPTION_KEY=ваш_постоянный_ключ_шифрования
   ```

2. Если токены были зашифрованы другим ключом, очистите их:
   ```bash
   python fix_encrypted_tokens.py
   ```

3. Перезапустите все сервисы:
   ```bash
   docker-compose restart
   ```

4. Введите действительные токены через веб-интерфейс снова.

#### 2. Недействительные токены

**Причина:** Введенные токены для социальных сетей недействительны или истекли.

**Решение:**
1. Проверьте, что токены для VK и Telegram действительны
2. Обновите токены через веб-интерфейс

#### 3. Некорректные настройки аккаунтов

**Причина:** Для VK не указан ID группы, для Telegram не указан канал.

**Решение:**
1. Через веб-интерфейс проверьте, что для каждого аккаунта указаны все необходимые настройки:
   - Для VK: ID группы (например, `-123456789`)
   - Для Telegram: Название канала (например, `@channel_name`)

## Проверка состояния системы

### Проверка логов воркера:
```bash
docker-compose logs worker
```

### Проверка количества аккаунтов:
```bash
docker-compose exec db psql -U crossposter -d crossposter -c "SELECT id, platform, account_name, is_active FROM social_accounts;"
```

### Проверка задач Celery:
```bash
docker-compose logs worker | grep -i "send_test_post_to_all_platforms"
```

## Диагностика отправки тестовых сообщений

Если проблема сохраняется, проверьте логи воркера при отправке тестового сообщения:

1. Отправьте тестовое сообщение через веб-интерфейс
2. Немедленно проверьте логи воркера:
   ```bash
   docker-compose logs worker
   ```

В логах должны отображаться подробности процесса отправки, включая успешные или неуспешные попытки отправки в каждую социальную сеть.